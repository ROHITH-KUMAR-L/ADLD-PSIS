<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ALP: Implementation of Stacks</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="page-wrapper">
        <header>
            <h1 class="main-title">ALP : Implementation of Stacks</h1>
        </header>

        <div class="content-grid">
            <!-- Left & Middle: The Visualizer and Pseudo-code (Inside Red Box) -->
            <div class="presentation-box">
                <div class="visual-area">
                    <div class="mem-addr top-addr">0</div>
                    <div class="stack-diagram">
                        <div class="label-to-top">ToP of the stack <span>â†˜</span></div>
                        <div class="stack-cells" id="stack-cells">
                            <!-- Cells generated by JS -->
                        </div>
                        <div class="sp-indicator" id="sp-indicator">
                            <span class="sp-text">SP -></span>
                        </div>
                        <div class="bottom-label">BOTTOM</div>
                    </div>
                    <div class="mem-addr bottom-addr">2<sup>k</sup> -1</div>
                    <div class="growth-caption">A Stock of Words in Memory (stack grows - Higher to Lower addresses)
                    </div>
                </div>

                <div class="code-area">
                    <div class="operation-block">
                        <h3 class="op-title">PUSH OPERATION..</h3>
                        <pre><code>Compare   #2000, SP
Branh > 0  EMPTY_ERROR
<span class="highlight">Subtract  #4, SP</span>
Move      NEWITEM, (SP)

; OR, autodecrement is supported
Move      NEWITEM, -(SP)</code></pre>
                    </div>

                    <div class="operation-block">
                        <h3 class="op-title">POP OPERATION...</h3>
                        <pre><code>Compare   #1500, SP
Branch <= 0 FULL_ERROR
Move      (SP), ITEM
<span class="highlight">Add       #4, SP</span>

;OR, if autoincrement is supported
Move      (SP)+, ITEM</code></pre>
                    </div>
                </div>
            </div>

            <!-- Right: Explanation Text -->
            <div class="explanation-area">
                <p>A stack is a list of words/bytes, operates with the LIFO principle, elements can be added/removed
                    using PUSH and POP operations.</p>

                <p>Shown in the figure, the stack of word data items in the memory (assuming byte addressable memory
                    with 32 bit word length), with fixed stack size of (BOTTOM :2000 TO 1500), with data element 43 at
                    the BOTTOM and -28 at the top, With top of the stack is pointed by special register SP -Stack
                    Pointer.</p>

                <p>It is common practice, stack grows in the direction of decreasing memory addresses, PUSH decrements
                    SP by 4, POP increments SP by 4.</p>

                <div class="interactive-controls">
                    <h3>Interactive Demo</h3>
                    <div class="input-row">
                        <input type="number" id="push-value" placeholder="Enter Value" value="10">
                        <button id="push-btn" class="btn btn-push">PUSH</button>
                    </div>
                    <button id="pop-btn" class="btn btn-pop">POP</button>
                    <div class="status">SP Value: <span id="sp-val">2000</span></div>
                </div>
            </div>
        </div>

        <section class="assembly-section">
            <div class="card">
                <h3>Complete Assembly Implementation</h3>
                <div class="assembly-code">
                    <pre><code><span class="comment">; ================================</span>
<span class="comment">; STACK IMPLEMENTATION WITH ERROR HANDLING</span>
<span class="comment">; ================================</span>

<span class="directive">ORIGIN</span> 100

<span class="comment">; ----------------</span>
<span class="comment">; Initialize Stack Pointer</span>
<span class="comment">; ----------------</span>
<span class="keyword">MOVE</span>    <span class="immediate">#2000</span>, <span class="register">SP</span>          <span class="comment">; STACK_BOTTOM = 2000</span>

<span class="comment">; ----------------</span>
<span class="comment">; PUSH OPERATION</span>
<span class="comment">; ----------------</span>
<span class="keyword">CMP</span>     <span class="immediate">#1500</span>, <span class="register">SP</span>          <span class="comment">; Compare with STACK_TOP</span>
<span class="keyword">BRANCH</span> &lt;=0 <span class="label">OVERFLOW_ERR</span>   <span class="comment">; If SP &lt;= 1500 â†’ overflow</span>

<span class="keyword">MOVE</span>    <span class="label">NUM</span>, <span class="register">R0</span>
<span class="keyword">SUB</span>     <span class="immediate">#4</span>, <span class="register">SP</span>             <span class="comment">; SP = SP - 4</span>
<span class="keyword">MOVE</span>    <span class="register">R0</span>, (<span class="register">SP</span>)           <span class="comment">; Push value</span>

<span class="comment">; ----------------</span>
<span class="comment">; POP OPERATION</span>
<span class="comment">; ----------------</span>
<span class="keyword">CMP</span>     <span class="immediate">#2000</span>, <span class="register">SP</span>          <span class="comment">; Compare with STACK_BOTTOM</span>
<span class="keyword">BRANCH</span> &gt;=0 <span class="label">UNDERFLOW_ERR</span>  <span class="comment">; If SP &gt;= 2000 â†’ underflow</span>

<span class="keyword">MOVE</span>    (<span class="register">SP</span>), <span class="register">R1</span>           <span class="comment">; Pop value</span>
<span class="keyword">ADD</span>     <span class="immediate">#4</span>, <span class="register">SP</span>             <span class="comment">; SP = SP + 4</span>

<span class="keyword">MOVE</span>    <span class="register">R1</span>, <span class="label">RESULT</span>
<span class="keyword">BRANCH</span>  <span class="label">END_PROGRAM</span>

<span class="comment">; ----------------</span>
<span class="comment">; ERROR HANDLERS</span>
<span class="comment">; ----------------</span>
<span class="label">OVERFLOW_ERR:</span>
    <span class="keyword">MOVE</span>    <span class="immediate">#1</span>, <span class="label">ERROR_CODE</span> <span class="comment">; 1 = overflow</span>
    <span class="keyword">BRANCH</span>  <span class="label">END_PROGRAM</span>

<span class="label">UNDERFLOW_ERR:</span>
    <span class="keyword">MOVE</span>    <span class="immediate">#2</span>, <span class="label">ERROR_CODE</span> <span class="comment">; 2 = underflow</span>
    <span class="keyword">BRANCH</span>  <span class="label">END_PROGRAM</span>

<span class="label">END_PROGRAM:</span>
    <span class="keyword">BRANCH</span> <span class="label">END_PROGRAM</span>     <span class="comment">; Halt by infinite loop</span>

<span class="comment">; ================================</span>
<span class="comment">; DATA SECTION</span>
<span class="comment">; ================================</span>
<span class="directive">ORIGIN</span> 2100

<span class="label">NUM:</span>        <span class="directive">DATAWORD</span> 25
<span class="label">RESULT:</span>     <span class="directive">RESERVE</span> 4
<span class="label">ERROR_CODE:</span> <span class="directive">RESERVE</span> 4

<span class="directive">END</span></code></pre>
                </div>

                <div class="code-explanation">
                    <h4>ðŸ“– Line-by-Line Explanation</h4>
                    <div class="explanation-grid">
                        <div class="exp-item">
                            <strong>ORIGIN 100</strong>
                            <p>Sets the starting address of the program code to memory location 100.</p>
                        </div>
                        <div class="exp-item">
                            <strong>MOVE #2000, SP</strong>
                            <p>Initializes the Stack Pointer to 2000 (STACK_BOTTOM). The '#' indicates an immediate
                                value.</p>
                        </div>
                        <div class="exp-item">
                            <strong>CMP #1500, SP</strong>
                            <p>Compares SP with 1500 (STACK_TOP limit). This checks if there's space before pushing.</p>
                        </div>
                        <div class="exp-item">
                            <strong>BRANCH &lt;=0 OVERFLOW_ERR</strong>
                            <p>If SP â‰¤ 1500, the stack is full. Jump to overflow error handler to prevent corruption.
                            </p>
                        </div>
                        <div class="exp-item">
                            <strong>MOVE NUM, R0</strong>
                            <p>Loads the value stored at memory location NUM (which is 25) into register R0.</p>
                        </div>
                        <div class="exp-item">
                            <strong>SUB #4, SP</strong>
                            <p>Decrements SP by 4 bytes (one word). Stack grows toward lower addresses, so SP: 2000 â†’
                                1996.</p>
                        </div>
                        <div class="exp-item">
                            <strong>MOVE R0, (SP)</strong>
                            <p>Stores the value in R0 (25) at the memory address pointed to by SP. Parentheses indicate
                                indirect addressing.</p>
                        </div>
                        <div class="exp-item">
                            <strong>CMP #2000, SP</strong>
                            <p>Compares SP with 2000 (STACK_BOTTOM). This checks if the stack is empty before popping.
                            </p>
                        </div>
                        <div class="exp-item">
                            <strong>BRANCH &gt;=0 UNDERFLOW_ERR</strong>
                            <p>If SP â‰¥ 2000, the stack is empty. Jump to underflow error handler to prevent invalid
                                access.</p>
                        </div>
                        <div class="exp-item">
                            <strong>MOVE (SP), R1</strong>
                            <p>Retrieves the value at the address pointed to by SP and loads it into R1. This is the POP
                                operation.</p>
                        </div>
                        <div class="exp-item">
                            <strong>ADD #4, SP</strong>
                            <p>Increments SP by 4 bytes. Stack shrinks, so SP: 1996 â†’ 2000.</p>
                        </div>
                        <div class="exp-item">
                            <strong>MOVE R1, RESULT</strong>
                            <p>Stores the popped value from R1 into the memory location labeled RESULT.</p>
                        </div>
                        <div class="exp-item">
                            <strong>OVERFLOW_ERR:</strong>
                            <p>Error handler for stack overflow. Sets ERROR_CODE to 1 to indicate overflow condition.
                            </p>
                        </div>
                        <div class="exp-item">
                            <strong>UNDERFLOW_ERR:</strong>
                            <p>Error handler for stack underflow. Sets ERROR_CODE to 2 to indicate underflow condition.
                            </p>
                        </div>
                        <div class="exp-item">
                            <strong>BRANCH END_PROGRAM</strong>
                            <p>Creates an infinite loop to halt program execution (jumps to itself).</p>
                        </div>
                        <div class="exp-item">
                            <strong>ORIGIN 2100</strong>
                            <p>Sets the starting address for data section to 2100 (separate from code).</p>
                        </div>
                        <div class="exp-item">
                            <strong>DATAWORD 25</strong>
                            <p>Allocates a 4-byte word initialized with value 25 at label NUM.</p>
                        </div>
                        <div class="exp-item">
                            <strong>RESERVE 4 (RESULT)</strong>
                            <p>Reserves 4 bytes of uninitialized memory at label RESULT for storing the popped value.
                            </p>
                        </div>
                        <div class="exp-item">
                            <strong>RESERVE 4 (ERROR_CODE)</strong>
                            <p>Reserves 4 bytes for ERROR_CODE. 0=success, 1=overflow, 2=underflow.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>
    <script src="script.js"></script>
</body>

</html>